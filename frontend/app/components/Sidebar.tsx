import React, { useState, useEffect } from 'react';
import Link from 'next/link';
import { useRouter } from 'next/router';
import {
  Box, Flex, Image, Text, VStack, Spacer, IconButton, useDisclosure, Drawer, DrawerBody,
  DrawerHeader, DrawerOverlay, DrawerContent, DrawerCloseButton, useMediaQuery,
  Divider,
} from '@chakra-ui/react';
import SignOutModal from './signOutModal';
import { signOut } from 'supertokens-auth-react/recipe/thirdparty';

const Sidebar = () => {
  const router = useRouter();
  const { isOpen, onOpen, onClose } = useDisclosure();
  const [isLargerThan768] = useMediaQuery("(min-width: 992px)");
  const [activePath, setActivePath] = useState('');
  const [isModalVisible, setModalVisible] = useState(false);


  useEffect(() => {
    setActivePath(router.pathname);
  }, [router.pathname]);

  const confirmSignOut = async () => {
    await signOut();
    router.replace('/');
  };

  const SidebarContent = () => (
    <Flex flexDirection="column" h="full">
      <Flex align="center" mb="24px" justifyContent="center">
        <Image src="https://res.cloudinary.com/dqyxqfvnv/image/upload/v1720208328/joint-icon_lsgi3s.png" alt="E-Cell IIT Hyderabad" h="40px" />
      </Flex>

      <Divider borderColor="white" />

      <VStack mt="24px" align="start" spacing={4} w="240px" flex="1">
        <Link href="/dashboard/portal" passHref>
          <Box as="a" display="flex" alignItems="center" _hover={{ textDecoration: 'none', bg: '#3A3154' }} p={2} borderRadius="md" w="240px"
            bg={activePath === '/dashboard/portal' ? '#3A3154' : 'transparent'}>
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M12.2614 4.74757C12.1916 4.68081 12.0988 4.64355 12.0022 4.64355C11.9056 4.64355 11.8128 4.68081 11.743 4.74757L3.11328 12.9915C3.07663 13.0265 3.04748 13.0687 3.02757 13.1153C3.00767 13.162 2.99744 13.2122 2.9975 13.2629L2.99609 21.0001C2.99609 21.3979 3.15413 21.7794 3.43543 22.0607C3.71674 22.342 4.09827 22.5001 4.49609 22.5001H9.00078C9.19969 22.5001 9.39046 22.4211 9.53111 22.2804C9.67176 22.1398 9.75078 21.949 9.75078 21.7501V15.3751C9.75078 15.2756 9.79029 15.1802 9.86062 15.1099C9.93094 15.0396 10.0263 15.0001 10.1258 15.0001H13.8758C13.9752 15.0001 14.0706 15.0396 14.1409 15.1099C14.2113 15.1802 14.2508 15.2756 14.2508 15.3751V21.7501C14.2508 21.949 14.3298 22.1398 14.4705 22.2804C14.6111 22.4211 14.8019 22.5001 15.0008 22.5001H19.5036C19.9014 22.5001 20.2829 22.342 20.5643 22.0607C20.8456 21.7794 21.0036 21.3979 21.0036 21.0001V13.2629C21.0037 13.2122 20.9934 13.162 20.9735 13.1153C20.9536 13.0687 20.9245 13.0265 20.8878 12.9915L12.2614 4.74757Z" fill="#F3F3F3" />
              <path d="M23.0114 11.4445L19.5052 8.09016V3C19.5052 2.80109 19.4262 2.61032 19.2855 2.46967C19.1448 2.32902 18.9541 2.25 18.7552 2.25H16.5052C16.3063 2.25 16.1155 2.32902 15.9748 2.46967C15.8342 2.61032 15.7552 2.80109 15.7552 3V4.5L13.0402 1.90406C12.7861 1.64719 12.4083 1.5 12 1.5C11.5931 1.5 11.2163 1.64719 10.9622 1.90453L0.991893 11.4436C0.70033 11.7248 0.663768 12.1875 0.92908 12.4922C0.995704 12.5691 1.07728 12.6316 1.16885 12.676C1.26041 12.7204 1.36005 12.7457 1.46169 12.7503C1.56334 12.755 1.66487 12.7389 1.7601 12.7031C1.85533 12.6672 1.94228 12.6124 2.01564 12.5419L11.7422 3.2475C11.812 3.18074 11.9048 3.14348 12.0014 3.14348C12.098 3.14348 12.1909 3.18074 12.2606 3.2475L21.9881 12.5419C22.1314 12.6793 22.3234 12.7543 22.5219 12.7504C22.7204 12.7465 22.9092 12.6641 23.047 12.5212C23.3349 12.2231 23.311 11.7309 23.0114 11.4445Z" fill="#F3F3F3" />
            </svg>

            <Text ml={4}>Portal</Text>
          </Box>
        </Link>

        <Link href="/dashboard/myteam" passHref>
          <Box as="a" display="flex" alignItems="center" _hover={{ textDecoration: 'none', bg: '#3A3154' }} p={2} borderRadius="md" w="240px"
            bg={activePath === '/dashboard/myteam' ? '#3A3154' : 'transparent'}>
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M9.003 5.99993C9.003 5.20508 9.31875 4.44278 9.8808 3.88073C10.4428 3.31868 11.2051 3.00293 12 3.00293C12.7949 3.00293 13.5572 3.31868 14.1192 3.88073C14.6812 4.44278 14.997 5.20508 14.997 5.99993C14.997 6.79478 14.6812 7.55708 14.1192 8.11913C13.5572 8.68118 12.7949 8.99693 12 8.99693C11.2051 8.99693 10.4428 8.68118 9.8808 8.11913C9.31875 7.55708 9.003 6.79478 9.003 5.99993ZM12 4.50293C11.8034 4.50293 11.6087 4.54165 11.4271 4.61688C11.2455 4.69211 11.0805 4.80238 10.9415 4.94139C10.8025 5.0804 10.6922 5.24543 10.617 5.42705C10.5417 5.60868 10.503 5.80334 10.503 5.99993C10.503 6.19652 10.5417 6.39118 10.617 6.57281C10.6922 6.75443 10.8025 6.91946 10.9415 7.05847C11.0805 7.19748 11.2455 7.30775 11.4271 7.38298C11.6087 7.45821 11.8034 7.49693 12 7.49693C12.397 7.49693 12.7778 7.33921 13.0585 7.05847C13.3393 6.77773 13.497 6.39696 13.497 5.99993C13.497 5.6029 13.3393 5.22213 13.0585 4.94139C12.7778 4.66065 12.397 4.50293 12 4.50293ZM16.5 6.74993C16.5 6.45446 16.5582 6.16187 16.6713 5.88889C16.7843 5.61591 16.9501 5.36787 17.159 5.15894C17.3679 4.95001 17.616 4.78427 17.889 4.6712C18.1619 4.55813 18.4545 4.49993 18.75 4.49993C19.0455 4.49993 19.3381 4.55813 19.611 4.6712C19.884 4.78427 20.1321 4.95001 20.341 5.15894C20.5499 5.36787 20.7157 5.61591 20.8287 5.88889C20.9418 6.16187 21 6.45446 21 6.74993C21 7.34667 20.7629 7.91896 20.341 8.34092C19.919 8.76288 19.3467 8.99993 18.75 8.99993C18.1533 8.99993 17.581 8.76288 17.159 8.34092C16.7371 7.91896 16.5 7.34667 16.5 6.74993ZM18.75 5.99993C18.5511 5.99993 18.3603 6.07895 18.2197 6.2196C18.079 6.36025 18 6.55102 18 6.74993C18 6.94884 18.079 7.13961 18.2197 7.28026C18.3603 7.42091 18.5511 7.49993 18.75 7.49993C18.9489 7.49993 19.1397 7.42091 19.2803 7.28026C19.421 7.13961 19.5 6.94884 19.5 6.74993C19.5 6.55102 19.421 6.36025 19.2803 6.2196C19.1397 6.07895 18.9489 5.99993 18.75 5.99993ZM5.25 4.49993C4.65326 4.49993 4.08097 4.73698 3.65901 5.15894C3.23705 5.5809 3 6.15319 3 6.74993C3 7.34667 3.23705 7.91896 3.65901 8.34092C4.08097 8.76288 4.65326 8.99993 5.25 8.99993C5.84674 8.99993 6.41903 8.76288 6.84099 8.34092C7.26295 7.91896 7.5 7.34667 7.5 6.74993C7.5 6.15319 7.26295 5.5809 6.84099 5.15894C6.41903 4.73698 5.84674 4.49993 5.25 4.49993ZM4.5 6.74993C4.5 6.55102 4.57902 6.36025 4.71967 6.2196C4.86032 6.07895 5.05109 5.99993 5.25 5.99993C5.44891 5.99993 5.63968 6.07895 5.78033 6.2196C5.92098 6.36025 6 6.55102 6 6.74993C6 6.94884 5.92098 7.13961 5.78033 7.28026C5.63968 7.42091 5.44891 7.49993 5.25 7.49993C5.05109 7.49993 4.86032 7.42091 4.71967 7.28026C4.57902 7.13961 4.5 6.94884 4.5 6.74993ZM6.402 10.4999C6.13867 10.956 6.00002 11.4733 6 11.9999H3V15.7499C2.99988 16.123 3.09254 16.4903 3.26965 16.8187C3.44676 17.1471 3.70275 17.4263 4.01458 17.6312C4.32641 17.836 4.6843 17.9601 5.05601 17.9923C5.42773 18.0245 5.80161 17.9637 6.144 17.8154C6.255 18.3119 6.429 18.7859 6.654 19.2284C6.0847 19.4583 5.46766 19.5449 4.85708 19.4805C4.24651 19.4162 3.66106 19.2029 3.15216 18.8595C2.64326 18.516 2.22648 18.0529 1.93841 17.5107C1.65034 16.9685 1.4998 16.3639 1.5 15.7499V11.9999C1.5 11.6021 1.65804 11.2206 1.93934 10.9393C2.22064 10.658 2.60218 10.4999 3 10.4999H6.402ZM17.346 19.2284C17.9153 19.4583 18.5323 19.5449 19.1429 19.4805C19.7535 19.4162 20.3389 19.2029 20.8478 18.8595C21.3567 18.516 21.7735 18.0529 22.0616 17.5107C22.3497 16.9685 22.5002 16.3639 22.5 15.7499V11.9999C22.5 11.6021 22.342 11.2206 22.0607 10.9393C21.7794 10.658 21.3978 10.4999 21 10.4999H17.598C17.853 10.9409 18 11.4524 18 11.9999H21V15.7499C21.0001 16.123 20.9075 16.4903 20.7304 16.8187C20.5532 17.1471 20.2973 17.4263 19.9854 17.6312C19.6736 17.836 19.3157 17.9601 18.944 17.9923C18.5723 18.0245 18.1984 17.9637 17.856 17.8154C17.742 18.3134 17.572 18.7844 17.346 19.2284ZM9 10.4984C8.60218 10.4984 8.22064 10.6565 7.93934 10.9378C7.65804 11.2191 7.5 11.6006 7.5 11.9984V16.4999C7.5 17.6934 7.97411 18.838 8.81802 19.6819C9.66193 20.5258 10.8065 20.9999 12 20.9999C13.1935 20.9999 14.3381 20.5258 15.182 19.6819C16.0259 18.838 16.5 17.6934 16.5 16.4999V11.9999C16.5 11.6021 16.342 11.2206 16.0607 10.9393C15.7794 10.658 15.3978 10.4999 15 10.4999L9 10.4984ZM9 11.9984H15V16.4999C15 17.2956 14.6839 18.0586 14.1213 18.6213C13.5587 19.1839 12.7956 19.4999 12 19.4999C11.2044 19.4999 10.4413 19.1839 9.87868 18.6213C9.31607 18.0586 9 17.2956 9 16.4999V11.9984Z" fill="#F3F3F3" />
            </svg>
            <Text ml={4}>My team</Text>
          </Box>
        </Link>

        <Link href="/dashboard/leaderboard" passHref>
          <Box as="a" display="flex" alignItems="center" _hover={{ textDecoration: 'none', bg: '#3A3154' }} p={2} borderRadius="md" w="240px"
            bg={activePath === '/dashboard/leaderboard' ? '#3A3154' : 'transparent'}>
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M15 19H9M15 19V8.6C15 8.44087 14.9368 8.28826 14.8243 8.17574C14.7117 8.06321 14.5591 8 14.4 8H9.6C9.44087 8 9.28826 8.06321 9.17574 8.17574C9.06321 8.28826 9 8.44087 9 8.6V19M15 19H20.4C20.5591 19 20.7117 18.9368 20.8243 18.8243C20.9368 18.7117 21 18.5591 21 18.4V15.1C21 14.9409 20.9368 14.7883 20.8243 14.6757C20.7117 14.5632 20.5591 14.5 20.4 14.5H15.6C15.4409 14.5 15.2883 14.5632 15.1757 14.6757C15.0632 14.7883 15 14.9409 15 15.1V19ZM9 19V13.1C9 12.9409 8.93679 12.7883 8.82426 12.6757C8.71174 12.5632 8.55913 12.5 8.4 12.5H3.6C3.44087 12.5 3.28826 12.5632 3.17574 12.6757C3.06321 12.7883 3 12.9409 3 13.1V18.4C3 18.5591 3.06321 18.7117 3.17574 18.8243C3.28826 18.9368 3.44087 19 3.6 19H9ZM15 5H9" stroke="#F3F3F3" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" />
            </svg>
            <Text ml={4}>Leaderboard</Text>
          </Box>
        </Link>

        <Link href="https://discord.com/invite/v967F6a8cz" target='_blank' passHref>
          <Box as="a" display="flex" alignItems="center" _hover={{ textDecoration: 'none', bg: '#3A3154' }} p={2} borderRadius="md" w="240px">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M19.2701 5.33005C17.9401 4.71005 16.5001 4.26005 15.0001 4.00005C14.987 3.99963 14.9739 4.00209 14.9618 4.00728C14.9497 4.01246 14.9389 4.02023 14.9301 4.03005C14.7501 4.36005 14.5401 4.79005 14.4001 5.12005C12.8091 4.88005 11.1911 4.88005 9.60012 5.12005C9.46012 4.78005 9.25012 4.36005 9.06012 4.03005C9.05012 4.01005 9.02012 4.00005 8.99012 4.00005C7.49012 4.26005 6.06012 4.71005 4.72012 5.33005C4.71012 5.33005 4.70012 5.34005 4.69012 5.35005C1.97012 9.42005 1.22012 13.38 1.59012 17.3C1.59012 17.32 1.60012 17.34 1.62012 17.35C3.42012 18.67 5.15012 19.47 6.86012 20C6.89012 20.01 6.92012 20 6.93012 19.98C7.33012 19.43 7.69012 18.85 8.00012 18.24C8.02012 18.2 8.00012 18.16 7.96012 18.15C7.39012 17.93 6.85012 17.67 6.32012 17.37C6.28012 17.35 6.28012 17.29 6.31012 17.26C6.42012 17.18 6.53012 17.09 6.64012 17.01C6.66012 16.99 6.69012 16.99 6.71012 17C10.1501 18.57 13.8601 18.57 17.2601 17C17.2801 16.99 17.3101 16.99 17.3301 17.01C17.4401 17.1 17.5501 17.18 17.6601 17.27C17.7001 17.3 17.7001 17.36 17.6501 17.38C17.1301 17.69 16.5801 17.94 16.0101 18.16C15.9701 18.17 15.9601 18.22 15.9701 18.25C16.2901 18.86 16.6501 19.44 17.0401 19.99C17.0701 20 17.1001 20.01 17.1301 20C18.8501 19.47 20.5801 18.67 22.3801 17.35C22.4001 17.34 22.4101 17.32 22.4101 17.3C22.8501 12.77 21.6801 8.84005 19.3101 5.35005C19.3001 5.34005 19.2901 5.33005 19.2701 5.33005ZM8.52012 14.91C7.49012 14.91 6.63012 13.96 6.63012 12.79C6.63012 11.62 7.47012 10.67 8.52012 10.67C9.58012 10.67 10.4201 11.63 10.4101 12.79C10.4101 13.96 9.57012 14.91 8.52012 14.91ZM15.4901 14.91C14.4601 14.91 13.6001 13.96 13.6001 12.79C13.6001 11.62 14.4401 10.67 15.4901 10.67C16.5501 10.67 17.3901 11.63 17.3801 12.79C17.3801 13.96 16.5501 14.91 15.4901 14.91Z" fill="#F3F3F3" />
            </svg>
            <Text ml={4}>Discord</Text>
          </Box>
        </Link>

        <Link href="" onClick={() => { setModalVisible(true) }}>
          <Box as="a" display="flex" alignItems="center" _hover={{ textDecoration: 'none', bg: '#3A3154' }} p={2} borderRadius="md" w="240px">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M17 7L15.59 8.41L18.17 11H8V13H18.17L15.59 15.58L17 17L22 12M4 5H12V3H4C2.9 3 2 3.9 2 5V19C2 20.1 2.9 21 4 21H12V19H4V5Z" fill="#F3F3F3" />
            </svg>
            <Text ml={4}>Sign out</Text>
          </Box>
        </Link>
      </VStack>

      <Spacer />

      {isLargerThan768 &&
        <Link href="/" passHref>
          <Box as="a" display="flex" alignItems="center" _hover={{ textDecoration: 'none', bg: '#3A3154' }} p={2} borderRadius="md">
            <svg width="21" height="15" viewBox="0 0 21 15" fill="none" xmlns="http://www.w3.org/2000/svg">
              <path d="M7.5 15L9.615 12.885L5.745 9H21V6H5.745L9.615 2.13L7.5 0L0 7.5" fill="#F3F3F3" />
            </svg>
            <Text ml={4}>Back to home page</Text>
          </Box>
        </Link>
      }
    </Flex>
  );

  return (
    <>
      <SignOutModal
        isVisible={isModalVisible}
        onClose={() => setModalVisible(false)}
        onConfirm={confirmSignOut}
        title='Are you sure you want to sign out?'
      />
      <Box display="flex">
        {isLargerThan768 ? (
          <Box
            bg="#1D1E37"
            w="300px"
            h="100vh"
            color="white"
            p={4}
            display="flex"
            flexDirection="column"
            position="fixed"
            zIndex="1000"
          >
            <SidebarContent />
          </Box>
        ) : (
          <>
            <Flex
              position="fixed"
              width="100%"
              justifyContent="space-between"
              zIndex="overlay"
            >
              <IconButton
                ml="18px"
                mt="18px"
                aria-label="Open menu"
                icon={<svg width="42" height="42" viewBox="0 0 42 42" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <rect width="42" height="42" rx="8" fill="#1D1E37" />
                  <path fill-rule="evenodd" clip-rule="evenodd" d="M11 13.25C11 12.5596 11.5596 12 12.25 12H29.75C30.4404 12 31 12.5596 31 13.25C31 13.9404 30.4404 14.5 29.75 14.5H12.25C11.5596 14.5 11 13.9404 11 13.25ZM11 20.75C11 20.0596 11.5596 19.5 12.25 19.5H29.75C30.4404 19.5 31 20.0596 31 20.75C31 21.4404 30.4404 22 29.75 22H12.25C11.5596 22 11 21.4404 11 20.75ZM12.25 27C11.5596 27 11 27.5596 11 28.25C11 28.9404 11.5596 29.5 12.25 29.5H29.75C30.4404 29.5 31 28.9404 31 28.25C31 27.5596 30.4404 27 29.75 27H12.25Z" fill="#F3F3F3" />
                </svg>}
                onClick={onOpen}
                bg="transparent"
                color="white"
                _hover={{ bg: 'transparent' }}
              />

              <IconButton
                mr="18px"
                mt="18px"
                aria-label="Back to home"
                icon={<svg width="42" height="42" viewBox="0 0 42 42" fill="none" xmlns="http://www.w3.org/2000/svg">
                  <rect width="42" height="42" rx="8" fill="#1D1E37" />
                  <path d="M21.2614 13.7486C21.1916 13.6818 21.0988 13.6445 21.0022 13.6445C20.9056 13.6445 20.8128 13.6818 20.743 13.7486L12.1133 21.9925C12.0766 22.0275 12.0475 22.0696 12.0276 22.1163C12.0077 22.1629 11.9974 22.2131 11.9975 22.2639L11.9961 30.0011C11.9961 30.3989 12.1541 30.7804 12.4354 31.0617C12.7167 31.343 13.0983 31.5011 13.4961 31.5011H18.0008C18.1997 31.5011 18.3905 31.422 18.5311 31.2814C18.6718 31.1407 18.7508 30.95 18.7508 30.7511V24.376C18.7508 24.2766 18.7903 24.1812 18.8606 24.1109C18.9309 24.0406 19.0263 24.001 19.1258 24.001H22.8758C22.9752 24.001 23.0706 24.0406 23.1409 24.1109C23.2113 24.1812 23.2508 24.2766 23.2508 24.376V30.7511C23.2508 30.95 23.3298 31.1407 23.4705 31.2814C23.6111 31.422 23.8019 31.5011 24.0008 31.5011H28.5036C28.9014 31.5011 29.2829 31.343 29.5643 31.0617C29.8456 30.7804 30.0036 30.3989 30.0036 30.0011V22.2639C30.0037 22.2131 29.9934 22.1629 29.9735 22.1163C29.9536 22.0696 29.9245 22.0275 29.8878 21.9925L21.2614 13.7486Z" fill="#F3F3F3" />
                  <path d="M32.0114 20.4445L28.5052 17.0902V12C28.5052 11.8011 28.4262 11.6103 28.2855 11.4697C28.1448 11.329 27.9541 11.25 27.7552 11.25H25.5052C25.3063 11.25 25.1155 11.329 24.9748 11.4697C24.8342 11.6103 24.7552 11.8011 24.7552 12V13.5L22.0402 10.9041C21.7861 10.6472 21.4083 10.5 21 10.5C20.5931 10.5 20.2163 10.6472 19.9622 10.9045L9.99189 20.4436C9.70033 20.7248 9.66377 21.1875 9.92908 21.4922C9.9957 21.5691 10.0773 21.6316 10.1688 21.676C10.2604 21.7204 10.36 21.7457 10.4617 21.7503C10.5633 21.755 10.6649 21.7389 10.7601 21.7031C10.8553 21.6672 10.9423 21.6124 11.0156 21.5419L20.7422 12.2475C20.812 12.1807 20.9048 12.1435 21.0014 12.1435C21.098 12.1435 21.1909 12.1807 21.2606 12.2475L30.9881 21.5419C31.1314 21.6793 31.3234 21.7543 31.5219 21.7504C31.7204 21.7465 31.9092 21.6641 32.047 21.5212C32.3349 21.2231 32.311 20.7309 32.0114 20.4445Z" fill="#F3F3F3" />
                </svg>}
                onClick={() => { router.push('/') }}
                bg="transparent"
                color="white"
                _hover={{ bg: 'transparent' }}
              />
            </Flex>

            <Drawer isOpen={isOpen} placement="left" onClose={onClose}>
              <DrawerOverlay>
                <DrawerContent bg="#1D1E37" color="white">
                  <DrawerCloseButton />
                  <DrawerHeader></DrawerHeader>
                  <DrawerBody>
                    <SidebarContent />
                  </DrawerBody>
                </DrawerContent>
              </DrawerOverlay>
            </Drawer>
          </>
        )}
      </Box>
    </>
  );
};

export default Sidebar;
